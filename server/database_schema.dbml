// Use DBML to define your database structure
// Docs: https://dbml.dbdiagram.io/docs

// Alamait Student Boarding Management System Database Schema

Table account_balance_history {
  id int [primary key]
  account_id int [not null]
  transaction_date date [not null]
  opening_balance decimal(15,2) [not null, default: 0.00]
  closing_balance decimal(15,2) [not null, default: 0.00]
  total_debits decimal(15,2) [not null, default: 0.00]
  total_credits decimal(15,2) [not null, default: 0.00]
  transaction_count int [not null, default: 0]
  created_at timestamp [default: `now()`]
}

Table account_migration_mapping {
  id int [primary key]
  old_account_id int [not null]
  old_branch_id int [not null]
  new_account_id int [not null]
  created_at timestamp [default: `now()`]
}

Table account_period_balances {
  id int [primary key]
  account_id int [not null]
  period_id int [not null]
  balance_brought_down decimal(15,2) [not null, default: 0.00]
  balance_carried_down decimal(15,2) [not null, default: 0.00]
  total_debits decimal(15,2) [not null, default: 0.00]
  total_credits decimal(15,2) [not null, default: 0.00]
  transaction_count int [not null, default: 0]
  is_verified tinyint(1) [default: 0]
  verified_by int
  verified_at timestamp
  notes text
  created_at timestamp [default: `now()`]
  updated_at timestamp [default: `now()`]
}

Table account_reconciliations {
  id int [primary key]
  account_id int [not null]
  reconciliation_date date [not null]
  book_balance decimal(15,2) [not null]
  bank_balance decimal(15,2) [not null]
  difference decimal(15,2) [not null, default: 0.00]
  status enum('pending','reconciled','unreconciled') [default: "pending"]
  notes text
  reconciled_by int
  reconciled_at timestamp
  created_at timestamp [default: `now()`]
  updated_at timestamp [default: `now()`]
}

Table audit_logs {
  id int [primary key]
  user_id int
  action varchar(50)
  entity varchar(50)
  entity_id int
  changes text
  timestamp timestamp [default: `now()`]
}

Table ba_payments {
  id int [primary key]
  student_id int [not null]
  amount decimal(15,2) [not null]
  payment_method varchar(50) [not null]
  payment_date date [not null]
  description text
  reference_number varchar(100)
  receipt_path varchar(500)
  status enum('pending','completed','rejected') [default: "pending"]
  approved_by int
  approved_at timestamp
  rejected_by int
  rejected_at timestamp
  rejection_reason text
  boarding_house_id int [not null]
  created_by int [not null]
  created_at timestamp [default: `now()`]
  updated_at timestamp [default: `now()`]
}

Table balance_periods {
  id int [primary key]
  period_name varchar(100) [not null]
  period_start_date date [not null]
  period_end_date date [not null]
  is_closed tinyint(1) [default: 0]
  closed_at timestamp
  closed_by int
  created_at timestamp [default: `now()`]
  updated_at timestamp [default: `now()`]
}

Table balance_verifications {
  id int [primary key]
  account_period_balance_id int [not null]
  verified_by int [not null]
  verification_date date [not null]
  previous_balance decimal(15,2) [not null]
  new_balance decimal(15,2) [not null]
  adjustment_amount decimal(15,2) [not null, default: 0.00]
  adjustment_reason text
  verification_notes text
  created_at timestamp [default: `now()`]
}

Table beds {
  id int [primary key]
  room_id int [not null]
  bed_number varchar(50) [not null]
  price decimal(15,2) [not null]
  status enum('available','occupied','maintenance','reserved') [default: "available"]
  student_id int
  enrollment_id int
  notes text
  bed_image varchar(255)
  created_at timestamp [default: `now()`]
  updated_at timestamp [default: `now()`]
  deleted_at timestamp
}

Table boarding_house_admins {
  id int [primary key]
  boarding_house_id int [not null]
  user_id int [not null]
  created_at timestamp [default: `now()`]
  updated_at timestamp [default: `now()`]
  deleted_at timestamp
}

Table boarding_houses {
  id int [primary key]
  name varchar(255) [not null]
  location text [not null]
  created_by int [not null]
  created_at timestamp [default: `now()`]
  updated_at timestamp [default: `now()`]
  deleted_at timestamp
}

Table budget_categories {
  id int [primary key]
  budget_request_id int [not null]
  category_name varchar(100) [not null]
  amount decimal(15,2) [not null]
  description text
  created_at timestamp [default: `now()`]
}

Table budget_requests {
  id int [primary key]
  boarding_house_id int [not null]
  month varchar(20) [not null]
  year int [not null]
  total_amount decimal(15,2) [not null]
  description text
  status enum('pending','approved','rejected') [default: "pending"]
  submitted_by int [not null]
  submitted_date timestamp [default: `now()`]
  approved_by int
  approved_date timestamp
  rejected_by int
  rejected_date timestamp
  rejection_reason text
  created_at timestamp [default: `now()`]
  updated_at timestamp [default: `now()`]
}

Table chart_of_accounts {
  id int [primary key]
  code varchar(20) [not null]
  name varchar(255) [not null]
  type enum('Asset','Liability','Equity','Revenue','Expense') [not null]
  is_category tinyint(1) [default: 0]
  parent_id int
  created_by int [not null]
  created_at timestamp [default: `now()`]
  updated_at timestamp [default: `now()`]
  deleted_at timestamp
}

Table chart_of_accounts_branch {
  id int [primary key]
  branch_id int [not null]
  code varchar(20) [not null]
  name varchar(255) [not null]
  type enum('Asset','Liability','Equity','Revenue','Expense') [not null]
  is_category tinyint(1) [default: 0]
  parent_id int
  created_by int [not null, default: 1]
  created_at timestamp [default: `now()`]
  updated_at timestamp [default: `now()`]
  deleted_at timestamp
}

Table currencies {
  code varchar(10) [primary key]
  name varchar(50)
  symbol varchar(10)
  is_base tinyint(1) [default: 0]
  created_at timestamp [default: `now()`]
}

Table current_account_balances {
  id int [primary key]
  account_id int [unique, not null]
  account_code varchar(20) [not null]
  account_name varchar(255) [not null]
  account_type enum('Asset','Liability','Equity','Revenue','Expense') [not null]
  current_balance decimal(15,2) [not null, default: 0.00]
  total_debits decimal(15,2) [not null, default: 0.00]
  total_credits decimal(15,2) [not null, default: 0.00]
  transaction_count int [not null, default: 0]
  last_transaction_date date
  created_at timestamp [default: `now()`]
  updated_at timestamp [default: `now()`]
}

Table exchange_rates {
  id int [primary key]
  base_currency varchar(10)
  target_currency varchar(10)
  rate decimal(18,8)
  effective_date date
  created_at timestamp [default: `now()`]
}

Table expenditure_attachments {
  id int [primary key]
  expenditure_request_id int [not null]
  file_name varchar(255) [not null]
  file_path varchar(500) [not null]
  file_size int
  mime_type varchar(100)
  uploaded_by int [not null]
  uploaded_at timestamp [default: `now()`]
}

Table expenditure_requests {
  id int [primary key]
  boarding_house_id int [not null]
  title varchar(255) [not null]
  description text
  amount decimal(15,2) [not null]
  category varchar(100) [not null]
  priority enum('low','medium','high','urgent') [default: "medium"]
  expected_date date
  vendor varchar(255)
  justification text [not null]
  status enum('pending','approved','rejected','actioned') [default: "pending"]
  submitted_by int [not null]
  submitted_date timestamp [default: `now()`]
  approved_by int
  approved_date timestamp
  rejected_by int
  rejected_date timestamp
  rejection_reason text
  created_at timestamp [default: `now()`]
  updated_at timestamp [default: `now()`]
}

Table expenses {
  id int [primary key]
  transaction_id int [not null]
  expense_date date [not null]
  amount decimal(10,2) [not null]
  description text
  payment_method enum('cash','bank_transfer','check','petty_cash','credit') [not null]
  payment_status enum('full','partial','debt') [default: "full"]
  total_amount decimal(10,2)
  remaining_balance decimal(10,2)
  remaining_payment_method enum('cash','bank_transfer','check','petty_cash','credit')
  reference_number varchar(50)
  expense_account_id int [not null]
  supplier_id int
  notes text
  created_by int [not null, default: 1]
  boarding_house_id int [not null]
  created_at timestamp [default: `now()`]
  updated_at timestamp [default: `now()`]
  deleted_at timestamp
  receipt_path varchar(255)
  receipt_original_name varchar(255)
}

Table journal_entries {
  id int [primary key]
  transaction_id int [not null]
  account_id int [not null]
  entry_type enum('debit','credit') [not null]
  amount decimal(12,2) [not null]
  description text
  boarding_house_id int [not null]
  created_by int [not null]
  created_at timestamp [default: `now()`]
  updated_at timestamp [default: `now()`]
  deleted_at timestamp
}

Table journal_lines {
  id int [primary key]
  journal_entry_id int
  account_id int
  amount decimal(12,2)
  type varchar(10)
  student_id int
  deleted_at timestamp
}

Table next_of_kin {
  id int [primary key]
  student_id int
  full_name varchar(255)
  relation varchar(100)
  phone_number varchar(50)
  address text
  created_at timestamp [default: `now()`]
  deleted_at timestamp
}

Table payment_receipts {
  id int [primary key]
  payment_id int [not null]
  file_path varchar(255) [not null]
  file_name varchar(255) [not null]
  uploaded_at timestamp [default: `now()`]
  deleted_at timestamp
}

Table petty_cash_accounts {
  id int [primary key]
  user_id int
  petty_cash_user_id int
  boarding_house_id int [not null]
  account_name varchar(255) [not null]
  account_code varchar(20) [not null]
  initial_balance decimal(15,2) [default: 0.00]
  current_balance decimal(15,2) [default: 0.00]
  beginning_balance decimal(15,2) [default: 0.00]
  total_inflows decimal(15,2) [default: 0.00]
  total_outflows decimal(15,2) [default: 0.00]
  status enum('active','inactive','suspended') [default: "active"]
  created_by int [not null]
  created_at timestamp [default: `now()`]
  updated_at timestamp [default: `now()`]
  deleted_at timestamp
}

Table petty_cash_transactions {
  id int [primary key]
  user_id int
  boarding_house_id int [not null]
  transaction_type enum('cash_inflow','cash_outflow','withdrawal','expense','student_payment','beginning_balance') [not null]
  amount decimal(15,2) [not null]
  description varchar(255) [not null]
  reference_number varchar(100)
  notes text
  transaction_date date [not null]
  created_by int [not null]
  created_at timestamp [default: `now()`]
  petty_cash_user_id int
}

Table petty_cash_users {
  id int [primary key]
  username varchar(255) [unique, not null]
  password varchar(255) [not null]
  boarding_house_id int [not null]
  created_by int [not null]
  created_at timestamp [default: `now()`]
  updated_at timestamp [default: `now()`]
  deleted_at timestamp
}

Table reconciliation_items {
  id int [primary key]
  reconciliation_id int [not null]
  transaction_id int
  journal_entry_id int
  description varchar(255) [not null]
  amount decimal(15,2) [not null]
  entry_type enum('debit','credit') [not null]
  transaction_date date [not null]
  is_reconciled tinyint(1) [default: 0]
  bank_reference varchar(100)
  notes text
  created_at timestamp [default: `now()`]
}

Table rentals {
  id int [primary key]
  enrollment_id int
  amount decimal(12,2)
  currency varchar(10)
  due_date date
  status varchar(50)
  paid_at timestamp
  created_at timestamp [default: `now()`]
  deleted_at timestamp
}

Table reports {
  id int [primary key]
  report_type varchar(50)
  generated_by int
  boarding_house_id int
  content text
  created_at timestamp [default: `now()`]
  deleted_at timestamp
}

Table room_images {
  id int [primary key]
  room_id int [not null]
  image_path varchar(255) [not null]
  original_name varchar(255) [not null]
  file_size int [not null]
  mime_type varchar(100) [not null]
  is_display_image tinyint(1) [default: 0]
  created_by int [not null]
  created_at timestamp [default: `now()`]
  updated_at timestamp [default: `now()`]
  deleted_at timestamp
}

Table rooms {
  id int [primary key]
  name varchar(255) [not null]
  capacity int [not null]
  bed_count int [default: 0]
  available_beds int [not null]
  price_per_bed decimal(10,2) [not null]
  description text
  status enum('active','inactive','maintenance') [default: "active"]
  boarding_house_id int [not null]
  created_at timestamp [default: `now()`]
  updated_at timestamp [default: `now()`]
  deleted_at timestamp
  admin_fee decimal(15,2) [default: 0.00]
  security_deposit decimal(15,2) [default: 0.00]
  additional_rent decimal(15,2) [default: 0.00]
}

Table saved_income_statements {
  id int [primary key]
  name varchar(255) [not null]
  start_date date [not null]
  end_date date [not null]
  boarding_house_id int
  is_consolidated tinyint(1) [default: 0]
  api_response json [not null]
  created_by int
  created_at timestamp [default: `now()`]
  updated_at timestamp [default: `now()`]
  deleted_at timestamp
}

Table student_account_balances {
  id int [primary key]
  student_id int [not null]
  enrollment_id int [not null]
  current_balance decimal(15,2) [not null, default: 0.00]
  currency varchar(3) [default: "USD"]
  created_at timestamp [default: `now()`]
  updated_at timestamp [default: `now()`]
  deleted_at timestamp
}

Table student_applications {
  id int [primary key]
  student_name varchar(255) [not null]
  email varchar(255) [not null]
  phone varchar(20) [not null]
  institution varchar(255) [not null]
  medical_history text
  room_id int [not null]
  bed_id int
  preferred_move_in_date date
  emergency_contact_name varchar(255)
  emergency_contact_phone varchar(20)
  emergency_contact_relationship varchar(100)
  additional_notes text
  status enum('pending','approved','rejected','under_review') [default: "pending"]
  admin_notes text
  created_at timestamp [default: `now()`]
  updated_at timestamp [default: `now()`]
  deleted_at timestamp
  national_id varchar(50)
  gender enum('Male','Female','Other')
  address text
  lease_start_date date
  lease_end_date date
  signature_data longtext
}

Table student_comments {
  id int [primary key]
  student_id int
  author_id int
  content text
  comment_type varchar(50)
  created_at timestamp [default: `now()`]
  deleted_at timestamp
}

Table student_documents {
  id int [primary key]
  student_id int
  doc_type varchar(50)
  file_path varchar(255)
  uploaded_at timestamp [default: `now()`]
  deleted_at timestamp
}

Table student_enrollments {
  id int [primary key]
  student_id int
  room_id int
  start_date date
  expected_end_date date
  agreed_amount decimal(12,2)
  currency varchar(10)
  notes text
  boarding_house_id int
  created_at timestamp [default: `now()`]
  deleted_at timestamp
  admin_fee decimal(15,2) [default: 0.00]
  security_deposit decimal(15,2) [default: 0.00]
  checkout_reason varchar(50)
  checkout_notes text
  checkout_checklist json
  checkout_date date
  checkout_status varchar(255)
}

Table student_invoices {
  id int [primary key]
  student_id int [not null]
  enrollment_id int [not null]
  amount decimal(15,2) [not null]
  description varchar(255) [not null]
  invoice_date date [not null]
  reference_number varchar(100)
  notes text
  status enum('pending','paid','overdue','cancelled') [default: "pending"]
  created_at timestamp [default: `now()`]
  updated_at timestamp [default: `now()`]
  deleted_at timestamp
}

Table student_payment_schedules {
  id int [primary key]
  enrollment_id int [not null]
  student_id int [not null]
  period_start_date date [not null]
  period_end_date date [not null]
  amount_due decimal(15,2) [not null]
  amount_paid decimal(15,2) [default: 0.00]
  currency varchar(3) [not null]
  status enum('pending','partial','paid','overdue') [default: "pending"]
  notes text
  created_at timestamp [default: `now()`]
  updated_at timestamp [default: `now()`]
  deleted_at timestamp
}

Table student_payments {
  id int [primary key]
  student_id int [not null]
  enrollment_id int [not null]
  schedule_id int
  amount decimal(15,2) [not null]
  payment_date date [not null]
  payment_method enum('cash_to_admin','cash_to_ba','bank','cash','bank_transfer','mobile_money') [not null]
  reference_number varchar(100)
  notes text
  created_by int [not null]
  created_at timestamp [default: `now()`]
  updated_at timestamp [default: `now()`]
  deleted_at timestamp
  payment_type varchar(50) [not null, default: "monthly_rent"]
  status varchar(20) [not null, default: "completed"]
  transaction_id int
}

Table students {
  id int [primary key]
  student_id varchar(20) [unique]
  full_name varchar(255)
  student_number varchar(100) [unique]
  national_id varchar(100)
  university varchar(255)
  gender varchar(20)
  address text
  phone_number varchar(50)
  boarding_house_id int
  joined_at date
  status varchar(50)
  created_at timestamp [default: `now()`]
  deleted_at timestamp
}

Table supplier_payments {
  id int [primary key]
  supplier_id int [not null]
  amount decimal(15,2) [not null]
  payment_date date [not null]
  payment_method enum('cash','petty_cash','bank_transfer','check','mobile_money','other') [default: "cash"]
  petty_cash_account_id int
  reference_number varchar(100)
  description text
  notes text
  expense_id int
  boarding_house_id int [not null]
  created_by int
  created_at timestamp [default: `now()`]
  updated_at timestamp [default: `now()`]
  deleted_at timestamp
}

Table suppliers {
  id int [primary key]
  company varchar(255)
  contact_person varchar(255)
  phone varchar(50)
  address text
  category varchar(100) [default: "General"]
  status enum('active','inactive') [default: "active"]
  boarding_house_id int [not null]
  created_at timestamp [default: `now()`]
  updated_at timestamp [default: `now()`]
}

Table transaction_rules {
  id int [primary key]
  transaction_type varchar(50)
  debit_account_id int
  credit_account_id int
  auto_post tinyint(1) [default: 0]
  notes text
  deleted_at timestamp
}

Table transactions {
  id int [primary key]
  transaction_type varchar(50)
  student_id int
  reference varchar(100)
  amount decimal(12,2)
  currency varchar(10)
  description varchar(255)
  transaction_date timestamp [default: `now()`]
  boarding_house_id int
  created_by int
  created_at timestamp [default: `now()`]
  deleted_at timestamp
  status enum('draft','posted','voided') [default: "posted"]
}

Table users {
  id int [primary key]
  username varchar(255)
  role varchar(50)
  email varchar(255)
  password varchar(255)
  national_id varchar(100)
  gender varchar(20)
  address text
  phone_number varchar(50)
  boarding_house_id int
  created_at timestamp [default: `now()`]
  deleted_at timestamp
}

// Relationships

Ref account_balance_history_ibfk_1: account_balance_history.account_id > chart_of_accounts.id
Ref account_period_balances_ibfk_1: account_period_balances.account_id > chart_of_accounts.id
Ref account_period_balances_ibfk_2: account_period_balances.period_id > balance_periods.id
Ref account_period_balances_ibfk_3: account_period_balances.verified_by > users.id
Ref account_reconciliations_ibfk_1: account_reconciliations.account_id > chart_of_accounts.id
Ref account_reconciliations_ibfk_2: account_reconciliations.reconciled_by > users.id
Ref ba_payments_ibfk_1: ba_payments.student_id > students.id
Ref ba_payments_ibfk_2: ba_payments.boarding_house_id > boarding_houses.id
Ref ba_payments_ibfk_3: ba_payments.created_by > users.id
Ref ba_payments_ibfk_4: ba_payments.approved_by > users.id
Ref ba_payments_ibfk_5: ba_payments.rejected_by > users.id
Ref balance_periods_ibfk_1: balance_periods.closed_by > users.id
Ref balance_verifications_ibfk_1: balance_verifications.account_period_balance_id > account_period_balances.id
Ref balance_verifications_ibfk_2: balance_verifications.verified_by > users.id
Ref beds_ibfk_1: beds.room_id > rooms.id
Ref beds_ibfk_2: beds.student_id > students.id
Ref beds_ibfk_3: beds.enrollment_id > student_enrollments.id
Ref budget_categories_ibfk_1: budget_categories.budget_request_id > budget_requests.id
Ref budget_requests_ibfk_1: budget_requests.boarding_house_id > boarding_houses.id
Ref budget_requests_ibfk_2: budget_requests.submitted_by > users.id
Ref budget_requests_ibfk_3: budget_requests.approved_by > users.id
Ref budget_requests_ibfk_4: budget_requests.rejected_by > users.id
Ref chart_of_accounts_branch_ibfk_1: chart_of_accounts_branch.parent_id > chart_of_accounts_branch.id
Ref chart_of_accounts_branch_ibfk_2: chart_of_accounts_branch.created_by > users.id
Ref chart_of_accounts_branch_ibfk_3: chart_of_accounts_branch.branch_id > boarding_houses.id
Ref current_account_balances_ibfk_1: current_account_balances.account_id > chart_of_accounts.id
Ref expenditure_attachments_ibfk_1: expenditure_attachments.expenditure_request_id > expenditure_requests.id
Ref expenditure_attachments_ibfk_2: expenditure_attachments.uploaded_by > users.id
Ref expenditure_requests_ibfk_1: expenditure_requests.boarding_house_id > boarding_houses.id
Ref expenditure_requests_ibfk_2: expenditure_requests.submitted_by > users.id
Ref expenditure_requests_ibfk_3: expenditure_requests.approved_by > users.id
Ref expenditure_requests_ibfk_4: expenditure_requests.rejected_by > users.id
Ref expenses_ibfk_1: expenses.transaction_id > transactions.id
Ref expenses_ibfk_2: expenses.expense_account_id > chart_of_accounts.id
Ref expenses_ibfk_3: expenses.created_by > users.id
Ref expenses_ibfk_4: expenses.boarding_house_id > boarding_houses.id
Ref expenses_ibfk_5: expenses.supplier_id > suppliers.id
Ref journal_entries_ibfk_1: journal_entries.transaction_id > transactions.id
Ref journal_entries_ibfk_2: journal_entries.account_id > chart_of_accounts.id
Ref journal_entries_ibfk_3: journal_entries.boarding_house_id > boarding_houses.id
Ref journal_entries_ibfk_4: journal_entries.created_by > users.id
Ref payment_receipts_ibfk_1: payment_receipts.payment_id > student_payments.id
Ref petty_cash_accounts_ibfk_1: petty_cash_accounts.user_id > users.id
Ref petty_cash_accounts_ibfk_2: petty_cash_accounts.boarding_house_id > boarding_houses.id
Ref petty_cash_accounts_ibfk_3: petty_cash_accounts.created_by > users.id
Ref petty_cash_transactions_ibfk_1: petty_cash_transactions.boarding_house_id > boarding_houses.id
Ref petty_cash_transactions_ibfk_2: petty_cash_transactions.created_by > users.id
Ref petty_cash_transactions_ibfk_3: petty_cash_transactions.user_id > users.id
Ref reconciliation_items_ibfk_1: reconciliation_items.reconciliation_id > account_reconciliations.id
Ref reconciliation_items_ibfk_2: reconciliation_items.transaction_id > transactions.id
Ref reconciliation_items_ibfk_3: reconciliation_items.journal_entry_id > journal_entries.id
Ref room_images_ibfk_1: room_images.room_id > rooms.id
Ref room_images_ibfk_2: room_images.created_by > users.id
Ref rooms_ibfk_1: rooms.boarding_house_id > boarding_houses.id
Ref student_account_balances_ibfk_1: student_account_balances.student_id > students.id
Ref student_account_balances_ibfk_2: student_account_balances.enrollment_id > student_enrollments.id
Ref student_applications_ibfk_1: student_applications.room_id > rooms.id
Ref student_applications_ibfk_2: student_applications.bed_id > beds.id
Ref student_invoices_ibfk_1: student_invoices.student_id > students.id
Ref student_invoices_ibfk_2: student_invoices.enrollment_id > student_enrollments.id
Ref student_payment_schedules_ibfk_1: student_payment_schedules.enrollment_id > student_enrollments.id
Ref student_payment_schedules_ibfk_2: student_payment_schedules.student_id > students.id
Ref student_payments_ibfk_4: student_payments.created_by > users.id
Ref student_payments_ibfk_5: student_payments.transaction_id > transactions.id
Ref supplier_payments_ibfk_1: supplier_payments.supplier_id > suppliers.id
Ref supplier_payments_ibfk_2: supplier_payments.expense_id > expenses.id
Ref supplier_payments_ibfk_3: supplier_payments.boarding_house_id > boarding_houses.id
Ref supplier_payments_ibfk_4: supplier_payments.created_by > users.id
Ref suppliers_ibfk_1: suppliers.boarding_house_id > boarding_houses.id
Ref transaction_rules_ibfk_1: transaction_rules.debit_account_id > chart_of_accounts.id
Ref transaction_rules_ibfk_2: transaction_rules.credit_account_id > chart_of_accounts.id
